---
format: html
editor: visual
---



```{r}
#| label: setup 
#| include: false
# Load libraries
library(logitr)
library(tidyverse)
library(fastDummies)
library(janitor)
library(here)
options(dplyr.width = Inf) # So you can see all of the columns

```

# Vehicle Choice Survey 
### Data Loading and Pre-processing:

```{r}
#| output: false
data_vehicle <- read_csv(here("code files", "testing_initial_data_modeling",  "vehicle_choice_data.csv"))


data_vehicle <- data_vehicle %>%
  mutate(operating_cost = parse_number(operating_cost),
         range = parse_number (range),
         age = 2025- make_year,
         price = price/1000,
         range = range /10, 
         mileage = mileage /1000
         )


# First create some dummy coded variables for categorical variables
data_vehicle <- dummy_cols(data_vehicle, c('powertrain'))

# Clean up names of created variables
data_vehicle <- clean_names(data_vehicle)

```


### Estimating Model:

```{r}
#| output: false
# Estimate the model
model <- logitr(
  data    = data_vehicle,
  outcome = "choice",
  obsID   = "obs_id",
  pars = c(
    "price",
    "mileage",
    "age",
    "operating_cost",
    "range",
    "powertrain_battery_electric",
    "powertrain_gas_hybrid",
    "powertrain_plug_in_hybrid"
    )
)
```


```{r}
summary(model)
```

## Interpretations: 

-   Negative preference to Price, mileage, age and operating cost as expected.
-   Negative preference to Battery electric vehicles but not statistically significant (probably because of the number of respondents are not high)



# Battery Choice Survey 
### Data Loading and Pre-processing:

```{r}
#| output: false
data_battery <- read_csv(here("code files", "testing_initial_data_modeling",  "battery_choice_data.csv"))
head(data_battery)

patterns <- c("_5.png", "_6.png", "_7.png", "_8.png" )

data_battery <- data_battery %>% 
  mutate(degradation_high = 
           ifelse(str_detect(image_degradation, paste(patterns, collapse = "|")), 1, 0)
  )


data_battery <- data_battery %>%
  mutate(
    veh_mileage = veh_mileage/1000,
    veh_price = veh_price/1000,
    battery_degradation = battery_degradation * 100,
    battery_range_year0 = battery_range_year0 /10,
    battery_range_year3 = battery_range_year3 /10
         ) %>% 
  select(-image_degradation, -image_refurbishment)

# Estimate MNL model

# First create some dummy coded variables for categorical variables
data_battery <- dummy_cols(data_battery, c('battery_refurbish', 'degradation_high'))

# Clean up names of created variables
data_battery <- clean_names(data_battery)

```


### Estimating Models:


```{r}
#| output: false
model1 <- logitr(
  data    = data_battery,
  outcome = "choice",
  obsID   = "obs_id",
  pars = c(
    "veh_price",
    "veh_mileage", 
    "battery_degradation", 
    "battery_range_year3", 
    "battery_refurbish_cellreplace",
    "battery_refurbish_packreplace"
  )
)
```



```{r}
summary(model1)
```

## Interpretations: 
-   Negative preference to Vehicle price and batery degradation as expected.



```{r}
#| output: false
model3 <- logitr(
  data    = data_battery,
  outcome = "choice",
  obsID   = "obs_id",
  pars = c(
    "degradation_high_1",
    "veh_price",
    "veh_mileage", 
    "battery_range_year0", 
    "battery_refurbish_cellreplace",
    "battery_refurbish_packreplace"
  )
)
```


```{r}
summary(model3)
```

